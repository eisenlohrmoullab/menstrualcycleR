---
title: "Getting Started with menstrualcycleR and Phase-Aligned Cycle Time Scaling (PACTS)"
author: "Anisha Nagpal, Tory Eisenlohr-Moul"
output: 
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
vignette: >
  %\VignetteIndexEntry{Getting Started with menstrualcycleR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  cache = FALSE
)
```


## What is PACTS, Scaled Cycle Time, and `menstrualcycleR`?

### Understanding the Challenge

Despite decades of research, there is still no standard method for operationalizing the menstrual cycle as a **continuous and cyclical biological process**. Traditional approaches—such as categorical phase labels or linear day-counting methods—oversimplify the cycle and introduce misalignment with underlying hormonal patterns. These methods often assume ovulation occurs at cycle midpoint and ignore variation in follicular versus luteal phase lengths, leading to reduced power, misclassification, and inconsistent findings across studies.

---

### Introducing PACTS

**Phase-Aligned Cycle Time Scaling (PACTS)** is a method that standardizes menstrual cycle time as a continuous variable aligned to **hormonally meaningful anchors**:  
- **Menses onset**
- **Ovulation**

Rather than dividing the cycle into arbitrary phases or counting forward from menses, PACTS treats the cycle as a **dynamic, time-varying system** and provides a framework to realign repeated measures (e.g., mood, symptoms, physiology) across individuals and cycles.

The PACTS method is implemented in the R package `menstrualcycleR`, which provides tools for:
- Assigning cycle days and cycle numbers
- Estimating or importing ovulation information
- Creating scaled time variables centered on ovulation or menses
- Visualizing and checking cycle-level data

---

### Why Continuous Cycle Modeling?

Shifting from categorical phase-based methods to continuous modeling offers several advantages:

- **Increased statistical power**: More observations per cycle can be included in analyses without discarding off-phase days.
- **Better precision**: Continuous time captures subtle, within-phase changes that are masked by averaging over phases.
- **More flexible modeling**: Mixed-effects models, splines, and time-varying predictors can be used to model within- and between-person variation in cycle dynamics.

See Eisenlohr-Moul et al. (2020), Schmalenberger et al. (2024), and Reen & Kiesner (2016) for supporting discussions.

---

### Anchoring on Ovulation and Menses

Most prior approaches count days forward from menses onset or backward from the end of the cycle, but **they fail to align data by ovulation**, which is the key inflection point in hormonal dynamics.

- The **follicular phase** (from menses to ovulation) is highly variable in length.
- The **luteal phase** (from ovulation to next menses) is more consistent across individuals and cycles.

Accordingly, PACTS assigns scaled time using:
- **Ovulation day = 0** when modeling ovulation-centered dynamics
- **Menses day = 0** when studying perimenstrual processes (e.g., dysmenorrhea)

The cycle is then scaled from –1 to +1, with negative values representing the **follicular phase** and positive values representing the **luteal phase**. This allows for flexible model fitting while retaining a biologically meaningful time structure.

---

### Estimating Ovulation When Biomarkers Are Unavailable

When ovulation is not confirmed using biomarkers (e.g., LH surge, BBT), PACTS uses a population-average method by assigning the **day of ovulation as 15 days prior to the next menses onset** (i.e., the last day of the follicular phase).

This backward-counting method is preferable to mid-cycle assumptions, which often misclassify ovulation in cycles with short or long follicular phases. The use of biomarkers is still recommended whenever possible to ensure precise alignment.

Functions in `menstrualcycleR` automatically flag imputed ovulation using a binary column (`ovtoday_impute`) so that users can report and model uncertainty.

---

### Purpose and Use Cases

The ultimate goal of PACTS and `menstrualcycleR` is to provide an open, reproducible framework to support cycle-based research in:
- **Affective and behavioral science**
- **Clinical research on hormone-related disorders** (e.g., PMDD, catamenial epilepsy)
- **Women's health and precision medicine**

By using a continuous, biologically aligned cycle time variable, researchers can better detect nuanced patterns in symptoms, physiology, and behavior that vary across the menstrual cycle.

---


## Data Requirements for Utilizing PACTS and `menstrualcycleR`

To apply the Phase-Aligned Cycle Time Scaling (PACTS) method and other core functionalities of the `menstrualcycleR` package, researchers must ensure their dataset meets several key criteria:

### 1. **Daily Data with Self-Reported Menses Onset**

Accurate identification of menstrual cycle boundaries is essential. At a minimum, the dataset must include:

- **Self-reported menses onset dates** throughout the study period  
- **The next menses onset date following study completion**, to ensure full-cycle alignment

These dates are used to define the start of each cycle and compute standardized time variables.

> **Note:** Menses onset cannot be imputed and must be provided for all usable cycles.

---

### 2. **Ovulation Assessment or Imputation**

The estimated day of ovulation (EDO) is required for analyses centered on the ovulatory phase. Ovulation may be:

- **Directly confirmed** using biomarkers such as:
  - Luteinizing hormone (LH) tests (EDO is day after positive test, LH+1 and must be reflected in input dataset)
  - Basal body temperature (BBT) (EDO is day after the nadir, nadir+1 and must be reflected in input dataset)
  - Ultrasound or hormone assays  
  
  
- **Imputed**, if biomarkers are unavailable, based on the assumption of a 14–15 day luteal phase. In this case, ovulation is assigned as **15 days before the next menses onset** by `menstrualcycleR`

Imputed ovulation days are recorded in a binary column, `ovtoday_impute`, created when using `menstrualcycleR` distinguishing them from confirmed values. Researchers are strongly encouraged to report the proportion of confirmed versus imputed ovulation days for transparency and scientific rigor.

---

### 3. **Cycle Length Inclusion Criteria**

By default, `menstrualcycleR` includes only cycles between **21 and 35 days** in length for standardized time variable computation. Cycles outside this range are excluded because they often show:

- Greater variability in timing
- Increased likelihood of anovulation

This range can be modified by the user, especially in cases where ovulation is confirmed for all cycles and the study population includes naturally shorter or longer cycles.


---

### 4. **Supported Variables and Formats**

The dataset should include the following columns:

| Column Name         | Description                                        |
|---------------------|----------------------------------------------------|
| `id`                | Unique participant identifier that needs to be a **numeric type**, it cannot be labeled with characters such as ID001, ID002, ...                     |
| `date`              | Calendar date of each observation. Ensure all id-date combinations are unique. You may wish to reclassify post-midnight survey entries to the previous day to maintain alignment with sleep or daily tracking data.                  |
| `menses`            | Binary indicator of **menses onset** (1 = yes, 0 = no)/ first day of menstruation. Periovulatory spotting should also be excluded. |
| `ovtoday`           | Binary indicator of confirmed ovulation day (optional) |
| `symptom variables` | Daily ratings of symptoms or behaviors of interest |

---

### References

- Nagpal et al. (2025). *Studying the Menstrual Cycle as a Continuous Variable: Implementing PACTS with the `menstrualcycleR` Package*. https://doi.org/10.31219/osf.io/hd5xw_v1  
- Schmalenberger et al. (2021). *How to study the menstrual cycle: Practical tools and recommendations*. *Psychoneuroendocrinology*, 123, 104895. https://doi.org/10.1016/j.psyneuen.2020.104895

---

## Installation of the `menstrualcycleR` package

Currently the `menstrualcycleR` package is hosted on the Eisenlohr-Moul Lab's (CLEAR Lab: Clarifying the Endocrinology of Acute Risk) GitHub repository. 

To install it from GitHub, install and load the package `remotes`` by running: 

```{r remotes, eval = F}
install.packages("remotes")
```

```{r loading-remotes, warning = F, eval = F}
library(remotes)
```

then install and load the `menstrualcycleR` package by running: 

```{r menstrualcycleR-package, eval = F}
remotes::install_github("eisenlohrmoullab/menstrualcycleR")
```

```{r loading menstrualcycleR-package}
library(menstrualcycleR)
```

Note that the `menstrualcycleR` package depends on several other packages (mostly packages from the [`tidyverse` suite](https://www.tidyverse.org/)).

This vignette also uses `tidyverse` functions so it is recommended to install and load the `tidyverse` suite by running:


```{r tidyverse, eval=FALSE}
install.packages("tidyverse")
```


```{r loading-tidyverse, warning=FALSE, eval=FALSE}
library(tidyverse)
```

Alternatively, individual packages can be loaded independently:

```{r loading-pcks, warning=FALSE}
library(dplyr)
library(ggplot2)
library(purrr)
library(tibble)
library(tidyr)
library(stringr)
library(magrittr)
```


Additionally in this vignette, we will cover options to use the continuous cycle time measures generated by `menstrualcycleR` in nonlinear multilevel analyses using the `mgcv` and `gam.hp` packages. You can install and load these packages by running: 

```{r gamm-packages-install, eval = F}
install.packages("mgcv")
install.packages("gam.hp")
```

```{r}
library(mgcv)
library(gam.hp)
```

---

## Using `menstrualcycleR`

### Overview of Package Functions

The `menstrualcycleR` package contains four main categories of functions:

---

#### 1. Cycle Scaling Function: `pacts_scaling()`

This function adds standardized cycle time variables to your dataset.

- `scaled_cycleday`:  
  A continuous cycle time variable centered on **menses onset** (`menses == 1 → 0`), ranging from –1 (start of luteal phase) to +1 (ovulation). Includes **only biomarker-confirmed** ovulation cycles.

- `scaled_cycleday_impute`:  
  Same as above, but also includes cycles with **imputed ovulation** (assigned to day –15 before next menses). Increases dataset coverage, but with lower precision.

- `scaled_cycleday_ov`:  
  A cycle time variable centered on **ovulation** (`ovtoday == 1 → 0`), ranging from –1 (start of follicular phase) to +1 (end of luteal phase). Biomarker-confirmed ovulation only.

- `scaled_cycleday_imp_ov`:  
  Same as above, but includes **imputed ovulation** (`ovtoday_impute == 1`) for cycles lacking confirmation. Centered on either confirmed or imputed ovulation.

- `ovtoday_impute`:  
  A binary indicator identifying **imputed ovulation days** (value = 1), estimated as 15 days before the next menses onset.

---

#### 2. Data Checking Functions

These functions assess the **completeness and coverage** of your dataset:

- `cycledata_check()`:  
  Summarizes non-missing data by cycle phase (follicular, luteal) and overall. Also produces **visualizations** by participant and cycle phase.

- `summary_ovulation()`:  
  Reports ovulation detection status:
  - How many cycles had **biomarker-confirmed** ovulation
  - How many cycles required **imputed ovulation** using the day –15 rule (`ovtoday_impute == 1`), based on standard luteal phase length

---

#### 3. Data Visualization Functions

Use these functions to **plot outcomes across the menstrual cycle**:

- `cycle_plot()`:  
  Creates a **sample-level plot** of symptom or outcome trajectories across the standardized cycle. Supports centering on either **menses** or **ovulation**, with flexible y-axis scaling.

- `cycle_plot_individual()`:  
  Provides **participant-level plots** across cycles for selected symptoms. Useful for individual inspection or diagnostic review.

Both functions:
- Calculate per-cycle means and deviations
- Allow centering on menses or ovulation
- Are compatible with scaled time variables

---

#### 4. Launching the Shiny App: `launch_app()`

This function launches an interactive Shiny application for uploading, checking, and analyzing menstrual cycle data using the package functions.

The app includes tools for:
- Scaled cycle time computation
- Data completeness checks
- Visualization by person and symptom
- PMDD, MRMD, and PME diagnosis using the **Carolina Premenstrual Assessment Scoring System (C-PASS)**

> C-PASS is implemented via the [`cpass`](https://lasy.github.io/cpass/) R package. Please cite this package if you utilize the CPASS tool in the shiny app:  
> Symul L, Eisenlohr-Moul T (2025). *cpass: PMDD and MRMD Diagnoses Following The Carolina Premenstrual Assessment Scoring System (C-PASS)*. R package version 0.1.0.

> For more on C-PASS as a diagnostic tool, see:  
> Eisenlohr-Moul, T. A., Girdler, S. S., Schmalenberger, K. M., Dawson, D. N., Surana, P., Johnson, J. L., & Rubinow, D. R. (2017).  
*Toward the Reliable Diagnosis of DSM-5 Premenstrual Dysphoric Disorder: The Carolina Premenstrual Assessment Scoring System (C-PASS).*  
> American Journal of Psychiatry, 174(1), 51–59. https://doi.org/10.1176/appi.ajp.2016.15121510
> **Please cite this paper if you utilize the CPASS tool in the shiny app.**

> **The shiny app is also accessible online here:**  
> 👉 https://menstrualcycledata.shinyapps.io/shiny/

---

### Demo dataset 

To explore the `menstrualcycleR` package, we will use a demo dataset with simulated daily ratings (labeled as `symptom`) from 25 participants with menses onset and ovulation information. The variable `menses` has a 1 when indicating first day of menstruation or menses onset. The variable `ovtoday` has a 1 when indicating the day after a positive luteinizing-hormone test, estimating the day of ovulation. 

```{r demo dataset}
cycle_df = cycledata
dim(cycle_df)
head(cycle_df)
```


### Applying PACTS

```{r pacts-scaling}
cycle_df_scaled = pacts_scaling(data = cycle_df, id = id, date = daterated, menses = menses, ovtoday = ovtoday, lower_cyclength_bound = 21, upper_cyclength_bound = 35)
```

For full documentation, type `?pacts_scaling()` in R console. The lower and upper cycle length bounds may be adjusted, but the default is 21-35 days as that was what was validated in Nagpal et al., (2025). Only cycles between 21 and 35 days will get scaled. 

`cycle_df_scaled` will now have additional variables as well as observations.  In this dataset we went from initially having 614 observations in `cycle_df` and then having 739 observations in `cycle_df_scaled`. 
When scaling the cycle using `pacts_scaling()`, each cycle is required to have a complete sequence of calendar days from menses onset to the next menses onset. If a participant missed reporting symptoms on any day within a cycle, the function inserts placeholder rows with `NA` values to ensure continuity. This process allows accurate computation of cycle-aligned time variables.


#### Before and After: Filling Missing Dates Within a Cycle

Below is an example showing how `pacts_scaling()` fills in rows for missing dates in a real participant's cycle.

**Original data (`cycle_df`)**

| id | menses | ovtoday | symptom | daterated   |
|----|--------|---------|---------|-------------|
| 1  | 1      | 0       | 5       | 2024-01-20  |
| 1  | 0      | 0       | 4       | 2024-01-21  |
| 1  | 0      | 0       | 1       | 2024-01-22  |
| 1  | 0      | 0       | 2       | 2024-01-24  |
| 1  | 0      | 0       | 3       | 2024-01-25  |
| 1  | 0      | 0       | 5       | 2024-01-26  |

- This participant **skipped reporting on 2024-01-23**.
- The time series is incomplete for cycle scaling until the gap is filled.

**After scaling (`cycle_df_scaled`)**

| id | menses | ovtoday | symptom | daterated   |
|----|--------|---------|---------|-------------|
| 1  | 1      | 0       | 5       | 2024-01-20  |
| 1  | 0      | 0       | 4       | 2024-01-21  |
| 1  | 0      | 0       | 1       | 2024-01-22  |
| 1  | 0      | 0       | NA      | 2024-01-23  |
| 1  | 0      | 0       | 2       | 2024-01-24  |
| 1  | 0      | 0       | 3       | 2024-01-25  |
| 1  | 0      | 0       | 5       | 2024-01-26  |

- The function inserts a placeholder row for 2024-01-23 with `NA` in the `symptom` column.
- This ensures complete daily continuity from menses to the end of the cycle.

---

#### Summary of Row Counts

| Dataset           | Observations | Description                                 |
|-------------------|--------------|---------------------------------------------|
| `cycle_df`        | 614          | Original data; only dates with reports      |
| `cycle_df_scaled` | 739          | Additional rows added to fill date gaps     |

By ensuring complete daily coverage, `pacts_scaling()` allows downstream modeling and visualization tools to interpret menstrual cycle time as a continuous, standardized variable across individuals and cycles.

---

#### Cycle time variables are added in cycle_df_scaled

```{r view-data}
names(cycle_df_scaled)
```

- `scaled_cycleday`:  
  A continuous cycle time variable centered on **menses onset** (`menses == 1 → 0`), ranging from –1 (start of luteal phase) to +1 (ovulation). Includes **only biomarker-confirmed** ovulation cycles.

- `scaled_cycleday_impute`:  
  Same as above, but also includes cycles with **imputed ovulation** (assigned to day –15 before next menses). Increases dataset coverage, but with lower precision.

- `scaled_cycleday_ov`:  
  A cycle time variable centered on **ovulation** (`ovtoday == 1 → 0`), ranging from –1 (start of follicular phase) to +1 (end of luteal phase). Biomarker-confirmed ovulation only.

- `scaled_cycleday_imp_ov`:  
  Same as above, but includes **imputed ovulation** (`ovtoday_impute == 1`) for cycles lacking confirmation. Centered on either confirmed or imputed ovulation.

- `ovtoday_impute`:  
  A binary indicator identifying **imputed ovulation days** (value = 1), estimated as 15 days before the next menses onset.
  
- `mcyclength`: 
  Indicates the length of a menses-to-menses cycle an observation belongs to. 
  
- `luteal_length`: 
  Indicates the length of the luteal phase an observation belongs to, when ovulation was not imputed. 
  
- `cycle_inomplete`
  A binary indicator identifying if the observation is part of an incomplete menses-to-menses cycle 
  

The following additional variables may be helpful for menstrual cycle analysis, but are not discussed in detail in Nagpal et al., (2025). 

- `cyclic_time`
 A continuous cycle time variable centered on **menses onset** (`menses == 1 → 0`), ranging from –1 to +1. Unlike `scaled_cycleday`, -1 and + 1 are parameterized to have the same hormonal meaning of **ovulation**.  Includes **only biomarker-confirmed** ovulation cycles.

- `cyclic_time_impute`
 Same as above, but also includes cycles with **imputed ovulation** (assigned to day –15 before next menses). Increases dataset coverage, but with lower precision.

- `cyclic_time_ov`
A cycle time variable centered on **ovulation** (`ovtoday == 1 → 0`), ranging from –1 to +1. Unlike `scaled_cycleday_ov`, -1 and + 1 are parameterized to have the same hormonal meaning of **menses_onset**.  Includes **only biomarker-confirmed** ovulation.

- `cyclic_time_imp_ov`
Same as above, but includes **imputed ovulation** (`ovtoday_impute == 1`) for cycles lacking confirmation. Centered on either confirmed or imputed ovulation.

---
  
  
### Checking Data availability 
  
To examine how much non-missing data is available, apply  `cycledata_check()`, inputting our resultant dataset from above (`df_with_scaling`) and choosing which outcomes you would like to look at. As of now, this function examines number of observations with a corresponding value for `scaled_cycleday_impute`. Here we are examining only 1 outcome: `symptom`. However, if you would like to look at more outcomes at once, replace `c("symptom")` with the outcomes of interest: e.g.`c("symptom1", "symptom2", "symptom3")`
  
```{r cycledata_check}
checkdata = cycledata_check(cycle_df_scaled, symptom_columns = c("symptom"))
```
  
This function will output a warning if any IDs have less than 10 observations in a menses-to-menses cycle for the outcome selected. 

We can examine how much non-missing data for `symptom` each ID has with a corresponding scaled cycle time measure (taking into account imputed ovulation) both overall, and by phase (luteal and follicular). 

```{r cycledata_check_by_id}
checkdata$by_id
```

We can also examine this in aggregate, looking at the sample as a whole: 

```{r cycledata_check_overall}
checkdata$overall
```

Overall, all 614 observations were scaled because they existed in menses-to-menses cycles between 21 and 35 days and there were no observations that were not bookended by either menses-onset or imputed ovulation. We can also visualize non-missing symptom data across the cycle: 

```{r cycledata_check_plot ,fig.width=8, fig.height=6}
checkdata$data_symptom_plots
```

### Checking Ovulation Data Availability 

```{r ovulation_summary}
ov_summary = summary_ovulation(cycle_df_scaled)
```

This function will help you evaluate how many cycles had a confirmed ovulation value prior to using `menstrualcycleR` and how many cycles had an ovulation day imputed via 15-day backward count via the `pacts_scaling()` function. (see [Estimating Ovulation When Biomarkers Are Unavailable](#estimating-ovulation-when-biomarkers-are-unavailable) and [Ovulation Assessment or Imputation](#ovulation-assessment-or-imputation)).

We can examine this across the entire sample: 

```{r ovulation_summary_total}
ov_summary$ovstatus_total
```

And also by each id in the dataset: 

```{r ovulation_summary_id}
ov_summary$ovstatus_id
```

Researchers are strongly encouraged to report the proportion of confirmed versus imputed ovulation days for transparency and scientific rigor.

### Visualizing outcomes across the cycle 

#### `cycle_plot()`

The `cycle_plot()` function generates a group-level visualization of symptom or outcome data across the standardized menstrual cycle. This function supports flexible centering (on menses or ovulation), person-centered or raw scaling, and optional smoothing via rolling averages. Rolling averages are supported by the package `zoo`. 


Let's take a look at the parameters of `cycle_plot`:


```{r eval = F}
cycle_plot(
  data,
  symptom,
  centering = "menses",
  include_impute = TRUE,
  y_scale = "person-centered_roll",
  rollingavg = 5,
  align_val = "center",
  se = FALSE
)
```


- `data`:  
  A dataframe containing the cycle-aligned data. Must include the relevant scaled cycle time variables (`scaled_cycleday`, `scaled_cycleday_ov`, etc.) and the symptom column. This function will only work if your dataset has been run through `pacts_scaling()` first.

- `symptom`:  
  A string specifying the name of the symptom or outcome variable to visualize.

- `centering`:  
  Whether to center the x-axis on `"menses"` (default) or `"ovulation"`. This determines which scaled cycle day variable is used.

- `include_impute`:  
  Logical. If `TRUE`, uses both confirmed and imputed ovulation cycles. Set to `FALSE` to restrict the analysis to biomarker-confirmed cycles only.

- `y_scale`:  
  Specifies how to scale the y-axis:
  - `"person-centered"`: Mean person-centered values
  - `"person-centered_roll"`: Smoothed person-centered values (default) that applies a rolling average to data, using `zoo::rollapply`
  - `"means"`: Raw mean values of participants 

- `rollingavg`:  
  Number of days used for rolling average smoothing (default = 5). Computed using `zoo::rollapply.`

- `align_val`:  
  Controls alignment of the rolling average window (`"center"`, `"left"`, or `"right"`). Passed to `zoo::rollapply`.

- `se`:  
  Logical. If `TRUE`, includes a standard error ribbon around the group mean.
  

> **Note:** If you use the `"person_centered_roll"` option for the `y_scale`, please cite the `zoo` package:  
> Zeileis A, Grothendieck G (2005). “zoo: S3 Infrastructure for Regular and Irregular Time Series.”  
> *Journal of Statistical Software*, *14*(6), 1–27.  
> [https://doi.org/10.18637/jss.v014.i06](https://doi.org/10.18637/jss.v014.i06)


---

#### Symptom, Menses-centered

```{r cycle_plot_menses_raw}
cycle_plot_df_menses <- cycle_plot(
  cycle_df_scaled,
  "symptom",
  centering = "menses",
  include_impute = TRUE,
  y_scale = "person-centered_roll", 
  se = T
)

```


`cycle_plot()` returns a list with three components:

1. **data**: The original data augmented with person-mean (`.m`) and deviation (`.d`) values for the symptom.

A "person-mean" is the average of all of a single participant’s repeated scores or measurements over time. It represents a way to summarize what is "typical" for a given person, and is used for “between-person” or “trait-level” analyses. 

•	By extension, “deviations from person-mean" represent the differences between a person’s score on a specific day (or other repeated measure interval) and their usual average (their person-mean). It tells us how much higher or lower they are compared to their normal, and is used in “within-person” or “state-level” analyses. 

2. **summary**: A summary of the outcome variable at each 5% increment of the scaled cycle timeline.It also provides standard errors if `se = T` is included in the function parameters. 

3. **plot**: A `ggplot2` object visualizing the trajectory of the symptom variable across the cycle.


```{r cycle_plot_menses_raw_data}
cycle_plot_df_menses$data
```

```{r cycle_plot_menses_raw_summary}
cycle_plot_df_menses$summary
```

```{r cycle_plot_menses_raw_plot, fig.width=8, fig.height=6}
cycle_plot_df_menses$plot
```


#### Symptom, Ovulation-centered

Here is the same data, centered on ovulation. 


```{r cycle_plot_ov_roll_plot}
cycle_plot_df_ov <- cycle_plot(
  cycle_df_scaled,
  "symptom",
  centering = "ovulation",
  include_impute = TRUE,
  y_scale = "person-centered_roll", 
  se = T
)

```

```{r cycle_plot_ov_roll_plot_access, fig.width=8, fig.height=6}
cycle_plot_df_ov$plot
```

### Visualizing Individual Participants and Cycles with `cycle_plot_individual()`

####  `cycle_plot_individual`

The `cycle_plot_individual()` function generates **cycle-specific plots and summaries** for a given participant ID. This function is especially useful for quality control, or individualized data visualization. It produces one plot per cycle, centered on either menses or ovulation, and includes summary data for each. Rolling averages are supported by the package `zoo`. 


Let's take a look at the parameters of `cycle_plot_individual`:

```{r eval = F}
cycle_plot_individual(
  data,
  id,
  symptoms,
  centering = "menses",
  y_scale = "person-centered",
  include_impute = TRUE,
  rollingavg = 5
)
```


- `data`:  
  A dataframe containing scaled cycle data with at least `id`, `cyclenum`, and the relevant symptom variables. The dataframe must already include the appropriate scaled cycle time columns.

- `id`:  
  A numeric or character value specifying the participant ID to visualize.

- `symptoms`:  
  A character vector of one or more symptom variables to plot.

- `centering`:  
  Center the plot on `"menses"` (default) or `"ovulation"`. Determines which scaled time variable is used.

- `y_scale`:  
  Specifies the type of y-axis transformation:
  - `"person-centered"`: Deviation from participant mean
  - `"person-centered_roll"`: Smoothed person-centered values (default) that applies a rolling average to data, using `zoo::rollapply`
  - `"raw"`: Uncentered raw values
  - `"roll"`: Rolling average of raw values

- `include_impute`:  
  Logical. If `TRUE`, includes cycles with imputed ovulation.

- `rollingavg`:  
  Number of days to use in the rolling average window (default = 5). Applies only when using `"roll"` or `"person-centered_roll"` scales. Computed using `zoo::rollapply.`
  
  > **Note:** If you use the `"person_centered_roll"` option for the `y_scale`, please cite the `zoo` package:  
> Zeileis A, Grothendieck G (2005). “zoo: S3 Infrastructure for Regular and Irregular Time Series.”  
> *Journal of Statistical Software*, *14*(6), 1–27.  
> [https://doi.org/10.18637/jss.v014.i06](https://doi.org/10.18637/jss.v014.i06)


---

#### Symptom, Menses-centered

This is what the raw data of symptom looks like across the first (and only cycle) for ID = 2: 

```{r cycle_plot_menses_id_2_raw_plot, fig.width=8, fig.height=6}
cycle_plot_menses_id_2 <- cycle_plot_individual(
  cycle_df_scaled,
  id = 2, 
  "symptom",
  centering = "menses",
  y_scale = "raw",
  include_impute = TRUE
  
)

cycle_plot_menses_id_2$symptom$Cycle_1$plot
```

As you can see, it is difficult to examine any trends. Smoothing using `y_scale = "roll"` or `y_scale = "rollingavg"` will help us understand what the trajectory looks like for participant ID = 2. 

```{r cycle_plot_menses_id_2_roll_plot, fig.width=8, fig.height=6}
cycle_plot_menses_id_2 <- cycle_plot_individual(
  cycle_df_scaled,
  id = 2, 
  "symptom",
  centering = "menses",
  y_scale = "roll",
  include_impute = TRUE,
  rollingavg = 5
)

cycle_plot_menses_id_2$symptom$Cycle_1$plot
```


`cycle_plot_individual()` returns a list with two components accessible for every menses-to-menses cycle that exists for an individual:

1. **summary**: A summary of the outcome variable at each 5% increment of the scaled cycle timeline with computed deviations/ rolling deviations. 

“Deviations from person-mean" represent the differences between a person’s score on a specific day (or other repeated measure interval) and their usual average (their person-mean). It tells us how much higher or lower they are compared to their normal, and is used in “within-person” or “state-level” analyses.

3. **plot**: A `ggplot2` object visualizing the trajectory of the symptom variable across the cycle.

**summary** and **plot** are accessible for each menses-to-menses cycle a participant ID has in the dataset. 

#### Cycle_1 summary for ID = 2

```{r cycle_plot_menses_id_2_summary}
cycle_plot_menses_id_2$symptom$Cycle_1$summary
```

#### Cycle_1 plot for ID = 2

```{r cycle_plot_menses_id_2_plot_access, fig.width=8, fig.height=6}
cycle_plot_menses_id_2$symptom$Cycle_1$plot
```

Cycles can also be examined ovulation-centered. 

```{r cycle_plot_ov_id_2_summary, fig.width=8, fig.height=6}
cycle_plot_ov_id_2 <- cycle_plot_individual(
  cycle_df_scaled,
  id = 2, 
  "symptom",
  centering = "ovulation",
  y_scale = "roll",
  include_impute = TRUE,
  rollingavg = 5
)

cycle_plot_ov_id_2$symptom$Cycle_1$plot
```

