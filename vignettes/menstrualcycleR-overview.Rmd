---
title: "Getting Started with menstrualcycleR and Phase-Aligned Cycle Time Scaling (PACTS)"
author: "Anisha Nagpal, Tory Eisenlohr-Moul"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with menstrualcycleR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  cache = FALSE
)
```


# üîÑ What is PACTS, Scaled Cycle Time, and `menstrualcycleR`?

## Understanding the Challenge

Despite decades of research, there is still no standard method for operationalizing the menstrual cycle as a **continuous and cyclical biological process**. Traditional approaches‚Äîsuch as categorical phase labels or linear day-counting methods‚Äîoversimplify the cycle and introduce misalignment with underlying hormonal patterns. These methods often assume ovulation occurs at cycle midpoint and ignore variation in follicular versus luteal phase lengths, leading to reduced power, misclassification, and inconsistent findings across studies.

---

## Introducing PACTS

**Phase-Aligned Cycle Time Scaling (PACTS)** is a method that standardizes menstrual cycle time as a continuous variable aligned to **hormonally meaningful anchors**:  
- **Menses onset**
- **Ovulation**

Rather than dividing the cycle into arbitrary phases or counting forward from menses, PACTS treats the cycle as a **dynamic, time-varying system** and provides a framework to realign repeated measures (e.g., mood, symptoms, physiology) across individuals and cycles.

The PACTS method is implemented in the R package `menstrualcycleR`, which provides tools for:
- Assigning cycle days and cycle numbers
- Estimating or importing ovulation information
- Creating scaled time variables centered on ovulation or menses
- Visualizing and checking cycle-level data

---

## Why Continuous Cycle Modeling?

Shifting from categorical phase-based methods to continuous modeling offers several advantages:

- **Increased statistical power**: More observations per cycle can be included in analyses without discarding off-phase days.
- **Better precision**: Continuous time captures subtle, within-phase changes that are masked by averaging over phases.
- **More flexible modeling**: Mixed-effects models, splines, and time-varying predictors can be used to model within- and between-person variation in cycle dynamics.

See Eisenlohr-Moul et al. (2020), Schmalenberger et al. (2024), and Reen & Kiesner (2016) for supporting discussions.

---

## Anchoring on Ovulation and Menses

Most prior approaches count days forward from menses onset or backward from the end of the cycle, but **they fail to align data by ovulation**, which is the key inflection point in hormonal dynamics.

- The **follicular phase** (from menses to ovulation) is highly variable in length.
- The **luteal phase** (from ovulation to next menses) is more consistent across individuals and cycles.

Accordingly, PACTS assigns scaled time using:
- **Ovulation day = 0** when modeling ovulation-centered dynamics
- **Menses day = 0** when studying perimenstrual processes (e.g., dysmenorrhea)

The cycle is then scaled from ‚Äì1 to +1, with negative values representing the **follicular phase** and positive values representing the **luteal phase**. This allows for flexible model fitting while retaining a biologically meaningful time structure.

---

### Estimating Ovulation When Biomarkers Are Unavailable

When ovulation is not confirmed using biomarkers (e.g., LH surge, BBT), PACTS uses a population-average method by assigning the **day of ovulation as 15 days prior to the next menses onset** (i.e., the last day of the follicular phase).

This backward-counting method is preferable to mid-cycle assumptions, which often misclassify ovulation in cycles with short or long follicular phases. The use of biomarkers is still recommended whenever possible to ensure precise alignment.

The function automatically flags imputed ovulation using a binary column (`ovtoday_impute`) so that users can report and model uncertainty.

---

## Purpose and Use Cases

The ultimate goal of PACTS and `menstrualcycleR` is to provide an open, reproducible framework to support cycle-based research in:
- **Affective and behavioral science**
- **Clinical research on hormone-related disorders** (e.g., PMDD, catamenial epilepsy)
- **Women's health and precision medicine**

By using a continuous, biologically aligned cycle time variable, researchers can better detect nuanced patterns in symptoms, physiology, and behavior that vary across the menstrual cycle.

---


# üìä Data Requirements for Utilizing PACTS and `menstrualcycleR`

To apply the Phase-Aligned Cycle Time Scaling (PACTS) method and other core functionalities of the `menstrualcycleR` package, researchers must ensure their dataset meets several key criteria:

## 1. **Daily Data with Self-Reported Menses Onset**

Accurate identification of menstrual cycle boundaries is essential. At a minimum, the dataset must include:

- **Self-reported menses onset dates** throughout the study period  
- **The next menses onset date following study completion**, to ensure full-cycle alignment

These dates are used to define the start of each cycle and compute standardized time variables.

> **Note:** Menses onset cannot be imputed and must be provided for all usable cycles.

---

## 2. **Ovulation Assessment or Imputation**

The estimated day of ovulation (EDO) is required for analyses centered on the ovulatory phase. Ovulation may be:

- **Directly confirmed** using biomarkers such as:
  - Luteinizing hormone (LH) tests
  - Basal body temperature (BBT)
  - Ultrasound or hormone assays  
  
  
- **Imputed**, if biomarkers are unavailable, based on the assumption of a 14‚Äì15 day luteal phase. In this case, ovulation is assigned as **15 days before the next menses onset** by `menstrualcycleR`

Imputed ovulation days are recorded in a binary column, `ovtoday_impute`, created when using `menstrualcycleR` distinguishing them from confirmed values. Researchers are strongly encouraged to report the proportion of confirmed versus imputed ovulation days for transparency and scientific rigor.

---

## 3. **Cycle Length Inclusion Criteria**

By default, `menstrualcycleR` includes only cycles between **21 and 35 days** in length for standardized time variable computation. Cycles outside this range are excluded because they often show:

- Greater variability in timing
- Increased likelihood of anovulation

This range can be modified by the user, especially in cases where ovulation is confirmed for all cycles and the study population includes naturally shorter or longer cycles.


---

## 4. **Supported Variables and Formats**

The dataset should include the following columns:

| Column Name         | Description                                        |
|---------------------|----------------------------------------------------|
| `id`                | Unique participant identifier                      |
| `date`              | Calendar date of each observation. Ensure all id-date combinations are unique. You may wish to reclassify post-midnight survey entries to the previous day to maintain alignment with sleep or daily tracking data.                  |
| `menses`            | Binary indicator of **menses onset** (1 = yes, 0 = no)/ first day of menstruation. Periovulatory spotting should also be excluded. |
| `ovtoday`           | Binary indicator of confirmed ovulation day (optional) |
| `symptom variables` | Daily ratings of symptoms or behaviors of interest |

---

## üîç References

- Peters et al. (2024). *Perimenstrual dysphoria and cycle-centered modeling*. Under review.  
- Nagpal et al. (2025). *Studying the Menstrual Cycle as a Continuous Variable: Implementing PACTS with the `menstrualcycleR` Package*. https://doi.org/10.31219/osf.io/hd5xw_v1  
- Schmalenberger et al. (2021). *How to study the menstrual cycle: Practical tools and recommendations*. *Psychoneuroendocrinology*, 123, 104895. https://doi.org/10.1016/j.psyneuen.2020.104895

---

# Installation of the `menstrualcycleR` package

Currently the `menstrualcycleR` package is hosted on the Eisenlohr-Moul Lab's (CLEAR Lab: Clarifying the Endocrinology of Acute Risk) GitHub repository. 

To install it from GitHub, install and load the package `remotes`` by running: 

```{r remotes, eval = F}
install.packages("remotes")
```

```{r loading-remotes, warning = F, eval = F}
library(remotes)
```

then install and load the `menstrualcycleR` package by running: 

```{r menstrualcycleR-package, eval = F}
remotes::install_github("eisenlohrmoullab/menstrualcycleR")
```

```{r loading menstrualcycleR-package}
library(menstrualcycleR)
```

Note that the `menstrualcycleR` package depends on several other packages (mostly packages from the [`tidyverse` suite](https://www.tidyverse.org/)).

This vignette also uses `tidyverse` functions so it is recommended to install and load the `tidyverse` suite by running:


```{r tidyverse, eval=FALSE}
install.packages("tidyverse")
```


```{r loading-tidyverse, warning=FALSE, eval=FALSE}
library(tidyverse)
```

Alternatively, individual packages can be loaded independently:

```{r loading-pcks, warning=FALSE}
library(dplyr)
library(ggplot2)
library(purrr)
library(tibble)
library(tidyr)
library(stringr)
library(magrittr)
```


Additionally in this vignette, we will cover options to use the continuous cycle time measures generated by `menstrualcycleR` in nonlinear multilevel analyses using the `mgcv` and `gam.hp` packages. You can install and load these packages by running: 

```{r gamm-packages-install, eval = F}
install.packages("mgcv")
install.packages("gam.hp")
```

```{r}
library(mgcv)
library(gam.hp)
```

---

# Using `menstrualcycleR`


## Demo dataset 

To explore the `menstrualcycleR` package, we will use a demo dataset with simulated daily ratings (labeled as `symptom`) from 25 participants with menses onset and ovulation information. The variable `menses` has a 1 when indicating first day of menstruation or menses onset. The variable `ovtoday` has a 1 when indicating the day after a positive luteinizing-hormone test, estimating the day of ovulation. 

```{r demo dataset}
cycle_df = cycledata
dim(cycle_df)
head(cycle_df)
```


## Overview of package functions 

The `menstrualcycleR` package contains 4 types of functions: 

1. A cycle scaling function `pacts_scaling()` which will add scaled cycle time variables to your dataset. 

scaled_cycleday: A continuous cycle time variable centered on menses onset (menses == 1 ‚Üí 0), ranging from -1 (start of luteal phase) to +1 (ovulation). Only includes cycles with biomarker-confirmed ovulation.

scaled_cycleday_impute: Same as above, but includes cycles where ovulation was imputed using day -15. Offers broader coverage across the dataset, at the cost of lower precision.

scaled_cycleday_ov: A cycle time variable centered on ovulation day (ovtoday == 1 ‚Üí 0), ranging from -1 (start of follicular phase) to +1 (end of luteal phase). Only includes cycles with confirmed ovulation.

scaled_cycleday_imp_ov: Same as above, but uses imputed ovulation (ovtoday_impute == 1) for cycles lacking biomarker confirmation. Centered on either confirmed or imputed ovulation.

ovtoday_impute: A binary column indicating imputed ovulation days (value 1) for cycles without confirmed ovulation, estimated as 15 days before menses onset.

2. Data checking functions. There are 2 functions that will allow you to assess the completeness of your data. The function `cycledata_check` provides information about non-missing outcome data, stratified by cycle phases (luteal and follicular) and overall non-missing data. It also generates visualizations to view spread of non-missing data by individual and by phase. The function `summary_ovulation` provides tabular output for the entire dataset, and by id, of how many cycles ovulation was already confirmed and described in the original input dataset as well as how many cycles were using the backward-count method, which estimates ovulation as 15 days before the subsequent menses onset (ovtoday_impute == 1), based on the typical length of the luteal phase. 

3. Data visualization functions. There are 2 functions that will help you visualize your outcomes across the menstrual cycle: `cycle_plot` and `cycle_plot_individual`. Both functions calculate mean and deviation values for the symptom by participant, allows centering the visualization on menses or ovulation, and provides flexibility in choosing the y-axis scale for the plot. `cycle_plot` provides a sample overview and `cycle_plot_individual` provides outcome visualizations at the participant level by cycle.

4. Function to launch the shinyapp. The `launch_app` function launches an interactive Shiny application designed to help users upload and process their menstrual cycle data and utilize the above functions in an intuitive, user-friendly interface. It also allows for assessment of premenstrual dysphoric disorder (PMDD), menstrually-related mood disorder (MRMD), and premenstrual exacerbation (PME) using the validated diagnostic tool: Carolina Premenstrual Assessment Scoring System (C-PASS) for individual participants. This tool relies on the `cpass` R package: Symul L, Eisenlohr-Moul T (2025). cpass: PMDD and MRMD Diagnoses Following The Carolina Premenstrual Assessment Scoring System (C-PASS). R package version 0.1.0, https://lasy.github.io/cpass/.
For more information regarding the C-PASS as a diagnostic tool, see: Eisenlohr-Moul, T. A., Girdler, S. S., Schmalenberger, K. M., Dawson, D. N., Surana, P., Johnson, J. L., & Rubinow, D. R. (2017). Toward the Reliable Diagnosis of DSM-5 Premenstrual Dysphoric Disorder: The Carolina Premenstrual Assessment Scoring System (C-PASS). American Journal of Psychiatry, 174(1), 51‚Äì59. https://doi.org/10.1176/appi.ajp.2016.15121510
The shiny app is also accessible here: https://menstrualcycledata.shinyapps.io/shiny/ 


```{r}

```









